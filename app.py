# A√ëADIR AL INICIO DEL ARCHIVO, DESPU√âS DE LOS PAR√ÅMETROS_FORRAJEROS_BASE

# RECOMENDACIONES DE GANADER√çA REGENERATIVA
RECOMENDACIONES_REGENERATIVAS = {
    'ALFALFA': {
        'PR√ÅCTICAS_REGENERATIVAS': [
            "Sistema de pastoreo rotacional intensivo (PRV) - 1-3 d√≠as por potrero",
            "Integraci√≥n con leguminosas nativas para fijaci√≥n de nitr√≥geno",
            "Uso de biofertilizantes a base de microorganismos nativos",
            "Siembra de bancos de prote√≠na con variedades nativas"
        ],
        'MANEJO_SUELO': [
            "Aplicaci√≥n de compost de 2-3 ton/ha en √©pocas secas",
            "Uso de harinas de rocas para mineralizaci√≥n",
            "Inoculaci√≥n con micorrizas para mejor absorci√≥n",
            "Coberturas vivas con tr√©boles y otras leguminosas"
        ],
        'BIODIVERSIDAD': [
            "Corredores biol√≥gicos con vegetaci√≥n nativa",
            "Cercas vivas con especies multiprop√≥sito",
            "Rotaci√≥n con cultivos de cobertura en √©pocas lluviosas",
            "Manejo integrado de plagas con control biol√≥gico"
        ],
        'AGUA_RETENCI√ìN': [
            "Swales (zanjas de infiltraci√≥n) en pendientes suaves",
            "Keyline design para manejo de aguas",
            "Mulching con residuos vegetales locales",
            "Sistemas de riego por goteo con agua de lluvia"
        ]
    },
    'RAYGRASS': {
        'PR√ÅCTICAS_REGENERATIVAS': [
            "Pastoreo ultra r√°pido - 12-24 horas por lote",
            "Descansos prolongados de 45-60 d√≠as entre pastoreos",
            "Mezcla con tr√©bol blanco y rojo para fijaci√≥n N",
            "Uso de gallinas despu√©s del pastoreo bovino"
        ],
        'MANEJO_SUELO': [
            "Aplicaci√≥n de t√© de compost cada 30 d√≠as",
            "Mineralizaci√≥n con fosfatos naturales",
            "Inoculaci√≥n con bacterias fijadoras",
            "Aporques para mejorar estructura del suelo"
        ],
        'BIODIVERSIDAD': [
            "Asociaci√≥n con chicoria y plantago",
            "Bordes diversificados con plantas arom√°ticas",
            "Rotaci√≥n con avena forrajera en invierno",
            "Manejo de altura de pastoreo (8-10 cm)"
        ],
        'AGUA_RETENCI√ìN': [
            "Cosecha de agua de lluvia en microrepresas",
            "Puntos de bebederos m√≥viles",
            "Sombras naturales con √°rboles nativos",
            "Cobertura permanente del suelo"
        ]
    },
    'FESTUCA': {
        'PR√ÅCTICAS_REGENERATIVAS': [
            "Pastoreo racional Voisin - 4-7 d√≠as por poteo",
            "Integraci√≥n av√≠cola despu√©s del pastoreo bovino",
            "Uso de √°rboles forrajeros (Leucaena, Moringa)",
            "Sistemas silvopastoriles intensivos"
        ],
        'MANEJO_SUELO': [
            "Aplicaci√≥n de bokashi especializado",
            "Enmiendas con carbonatos naturales",
            "Inoculaci√≥n con trichoderma",
            "Labranza cero con siembra directa"
        ],
        'BIODIVERSIDAD': [
            "Mezclas con pastos nativos adaptados",
            "Cercas vivas con gliricidia y eritrina",
            "Rotaci√≥n con kikuyo en zonas altas",
            "Control mec√°nico de malezas selectivas"
        ],
        'AGUA_RETENCI√ìN': [
            "Terrazas de absorci√≥n en laderas",
            "Sistemas de riego por aspersi√≥n eficiente",
            "Barreras vivas contra erosi√≥n",
            "Retenci√≥n de humedad con mulching"
        ]
    },
    'AGROPIRRO': {
        'PR√ÅCTICAS_REGENERATIVAS': [
            "Pastoreo de precisi√≥n seg√∫n biomasa disponible",
            "Integraci√≥n con porcinos en lotes espec√≠ficos",
            "Uso de abonos verdes entre rotaciones",
            "Sistemas agrosilvopastoriles"
        ],
        'MANEJO_SUELO': [
            "Aplicaci√≥n de humus de lombriz",
            "Enmiendas con yeso agr√≠cola",
            "Inoculaci√≥n con azospirillum",
            "Coberturas muertas con paja"
        ],
        'BIODIVERSIDAD': [
            "Asociaci√≥n con brachiaria en zonas bajas",
            "Plantas repelentes naturales en bordes",
            "Rotaci√≥n con sorgo forrajero",
            "Manejo diferenciado por microclimas"
        ],
        'AGUA_RETENCI√ìN': [
            "Zanjas de drenaje y retenci√≥n",
            "Sistemas de sub-riego",
            "Cultivo en curvas a nivel",
            "Protecci√≥n de fuentes h√≠dricas"
        ]
    },
    'PASTIZAL_NATURAL': {
        'PR√ÅCTICAS_REGENERATIVAS': [
            "Pastoreo hol√≠stico planificado",
            "Manejo adaptativo multipaddock",
            "Regeneraci√≥n de pastos nativos",
            "Uso de herb√≠voros mixtos (ovinos, caprinos)"
        ],
        'MANEJO_SUELO': [
            "Regeneraci√≥n con microorganismos eficientes",
            "Mineralizaci√≥n con rocas molidas locales",
            "Inoculaci√≥n con hongos micorr√≠zicos nativos",
            "Coberturas con especies pioneras"
        ],
        'BIODIVERSIDAD': [
            "Recuperaci√≥n de bancos de semillas nativas",
            "Corredores de conectividad ecol√≥gica",
            "Manejo de carga animal seg√∫n estacionalidad",
            "Protecci√≥n de √°reas de regeneraci√≥n natural"
        ],
        'AGUA_RETENCI√ìN': [
            "Restauraci√≥n de quebradas y nacimientos",
            "Sistemas de cosecha de aguas lluvias",
            "Manejo de escorrent√≠as con geomembranas",
            "Recarga de acu√≠feros con t√©cnicas permaculturales"
        ]
    },
    'PERSONALIZADO': {
        'PR√ÅCTICAS_REGENERATIVAS': [
            "Dise√±o de sistema seg√∫n condiciones espec√≠ficas del terreno",
            "Monitoreo continuo con ajustes adaptativos",
            "Integraci√≥n animal seg√∫n recursos disponibles",
            "Planificaci√≥n hol√≠stica del manejo"
        ],
        'MANEJO_SUELO': [
            "An√°lisis de suelo para enmiendas espec√≠ficas",
            "Regeneraci√≥n seg√∫n diagn√≥stico particular",
            "Uso de insumos locales disponibles",
            "T√©cnicas adaptadas a la topograf√≠a"
        ],
        'BIODIVERSIDAD': [
            "Selecci√≥n de especies seg√∫n microclimas",
            "Dise√±o de paisaje productivo diversificado",
            "Manejo de sucesi√≥n ecol√≥gica",
            "Conservaci√≥n de germoplasma local"
        ],
        'AGUA_RETENCI√ìN': [
            "Dise√±o hidrol√≥gico keyline adaptado",
            "Sistemas de captaci√≥n y almacenamiento",
            "Manejo eficiente seg√∫n disponibilidad h√≠drica",
            "T√©cnicas de retenci√≥n espec√≠ficas para el terreno"
        ]
    }
}

# FUNCI√ìN PARA GENERAR PDF CON RECOMENDACIONES DE GANADER√çA REGENERATIVA
def generar_informe_pdf(gdf_analizado, tipo_pastura, peso_promedio, carga_animal, area_total, fecha_imagen, fuente_satelital):
    """Genera un informe PDF completo con an√°lisis forrajero y recomendaciones de ganader√≠a regenerativa"""
    
    try:
        # Crear buffer para el PDF
        buffer = io.BytesIO()
        doc = SimpleDocTemplate(buffer, pagesize=A4, topMargin=1*inch)
        styles = getSampleStyleSheet()
        
        # Crear estilos personalizados
        title_style = ParagraphStyle(
            'CustomTitle',
            parent=styles['Heading1'],
            fontSize=16,
            textColor=colors.darkgreen,
            spaceAfter=30,
            alignment=1  # Centrado
        )
        
        heading_style = ParagraphStyle(
            'CustomHeading',
            parent=styles['Heading2'],
            fontSize=14,
            textColor=colors.darkblue,
            spaceAfter=12,
            spaceBefore=12
        )
        
        subheading_style = ParagraphStyle(
            'CustomSubHeading',
            parent=styles['Heading3'],
            fontSize=12,
            textColor=colors.darkgreen,
            spaceAfter=8,
            spaceBefore=8
        )
        
        normal_style = styles['Normal']
        
        # Contenido del PDF
        story = []
        
        # T√≠tulo principal
        story.append(Paragraph("INFORME DE AN√ÅLISIS FORRAJERO CON GANADER√çA REGENERATIVA", title_style))
        story.append(Spacer(1, 20))
        
        # Informaci√≥n general
        story.append(Paragraph("INFORMACI√ìN GENERAL DEL AN√ÅLISIS", heading_style))
        info_data = [
            ["Tipo de Pastura:", tipo_pastura.replace('_', ' ').title()],
            ["√Årea Total Analizada:", f"{area_total:.2f} ha"],
            ["Peso Promedio Animal:", f"{peso_promedio} kg"],
            ["Carga Animal:", f"{carga_animal} cabezas"],
            ["Fuente Satelital:", fuente_satelital],
            ["Fecha de Imagen:", fecha_imagen.strftime("%d/%m/%Y")],
            ["Fecha de Generaci√≥n:", datetime.now().strftime("%d/%m/%Y %H:%M")]
        ]
        
        info_table = Table(info_data, colWidths=[2.5*inch, 3*inch])
        info_table.setStyle(TableStyle([
            ('BACKGROUND', (0, 0), (-1, 0), colors.lightseagreen),
            ('TEXTCOLOR', (0, 0), (-1, 0), colors.white),
            ('ALIGN', (0, 0), (-1, -1), 'LEFT'),
            ('FONTNAME', (0, 0), (-1, 0), 'Helvetica-Bold'),
            ('FONTSIZE', (0, 0), (-1, -1), 10),
            ('BOTTOMPADDING', (0, 0), (-1, 0), 12),
            ('BACKGROUND', (0, 1), (-1, -1), colors.white),
            ('GRID', (0, 0), (-1, -1), 1, colors.black)
        ]))
        story.append(info_table)
        story.append(Spacer(1, 20))
        
        # Estad√≠sticas resumen del an√°lisis
        story.append(Paragraph("ESTAD√çSTICAS DEL AN√ÅLISIS FORRAJERO", heading_style))
        
        # Calcular estad√≠sticas
        biomasa_promedio = gdf_analizado['biomasa_disponible_kg_ms_ha'].mean()
        ndvi_promedio = gdf_analizado['ndvi'].mean()
        cobertura_promedio = gdf_analizado['cobertura_vegetal'].mean()
        ev_total = gdf_analizado['ev_soportable'].sum()
        dias_promedio = gdf_analizado['dias_permanencia'].mean()
        
        # Distribuci√≥n de tipos de superficie
        distribucion_superficie = gdf_analizado['tipo_superficie'].value_counts()
        superficie_texto = ", ".join([f"{k}: {v} sub-lotes" for k, v in distribucion_superficie.items()])
        
        stats_data = [
            ["M√©trica", "Valor", "Interpretaci√≥n"],
            ["Biomasa Disponible Promedio", f"{biomasa_promedio:.0f} kg MS/ha", "Alta" if biomasa_promedio > 2000 else "Media" if biomasa_promedio > 1000 else "Baja"],
            ["NDVI Promedio", f"{ndvi_promedio:.3f}", "√ìptimo" if ndvi_promedio > 0.6 else "Moderado" if ndvi_promedio > 0.4 else "Bajo"],
            ["Cobertura Vegetal Promedio", f"{cobertura_promedio:.1%}", "Buena" if cobertura_promedio > 0.7 else "Regular" if cobertura_promedio > 0.4 else "Baja"],
            ["Equivalentes Vaca Totales", f"{ev_total:.1f} EV", f"Soportan {ev_total:.0f} animales"],
            ["D√≠as Permanencia Promedio", f"{dias_promedio:.1f} d√≠as", "Adecuado" if dias_promedio > 3 else "Corto"],
            ["Distribuci√≥n Superficie", superficie_texto, "Variabilidad del potrero"]
        ]
        
        stats_table = Table(stats_data, colWidths=[2.2*inch, 1.5*inch, 1.8*inch])
        stats_table.setStyle(TableStyle([
            ('BACKGROUND', (0, 0), (-1, 0), colors.darkblue),
            ('TEXTCOLOR', (0, 0), (-1, 0), colors.white),
            ('ALIGN', (0, 0), (-1, -1), 'LEFT'),
            ('FONTNAME', (0, 0), (-1, 0), 'Helvetica-Bold'),
            ('FONTSIZE', (0, 0), (-1, -1), 9),
            ('BOTTOMPADDING', (0, 0), (-1, 0), 12),
            ('BACKGROUND', (0, 1), (-1, -1), colors.white),
            ('GRID', (0, 0), (-1, -1), 1, colors.black),
            ('ROWBACKGROUNDS', (0, 1), (-1, -1), [colors.white, colors.lightgrey])
        ]))
        story.append(stats_table)
        story.append(Spacer(1, 20))
        
        # Mapa est√°tico del an√°lisis
        story.append(PageBreak())
        story.append(Paragraph("MAPAS DE AN√ÅLISIS", heading_style))
        
        # Generar mapa est√°tico para el PDF
        mapa_buffer = crear_mapa_detallado_vegetacion(gdf_analizado, tipo_pastura)
        if mapa_buffer:
            try:
                mapa_buffer.seek(0)
                img = Image(mapa_buffer, width=6*inch, height=4*inch)
                story.append(img)
                story.append(Spacer(1, 10))
                story.append(Paragraph("Figura 1: Mapa de Tipos de Superficie y Biomasa Disponible", normal_style))
            except Exception as e:
                story.append(Paragraph("Error al generar el mapa para el PDF", normal_style))
        
        story.append(Spacer(1, 20))
        
        # Tabla de resultados por sub-lote (primeras 10 zonas)
        story.append(Paragraph("RESULTADOS POR SUB-LOTE (PRIMERAS 10 ZONAS)", heading_style))
        
        # Preparar datos para tabla
        columnas_tabla = ['id_subLote', 'area_ha', 'tipo_superficie', 'ndvi', 
                         'biomasa_disponible_kg_ms_ha', 'ev_ha', 'dias_permanencia']
        
        df_tabla = gdf_analizado[columnas_tabla].head(10).copy()
        
        # Redondear valores
        df_tabla['area_ha'] = df_tabla['area_ha'].round(3)
        df_tabla['ndvi'] = df_tabla['ndvi'].round(3)
        df_tabla['biomasa_disponible_kg_ms_ha'] = df_tabla['biomasa_disponible_kg_ms_ha'].round(0)
        df_tabla['ev_ha'] = df_tabla['ev_ha'].round(3)
        df_tabla['dias_permanencia'] = df_tabla['dias_permanencia'].round(1)
        
        # Renombrar columnas para mejor visualizaci√≥n
        df_tabla.columns = ['Sub-Lote', '√Årea (ha)', 'Tipo Superficie', 'NDVI', 
                           'Biomasa Disp (kg MS/ha)', 'EV/Ha', 'D√≠as Perm.']
        
        # Convertir a lista para la tabla
        table_data = [df_tabla.columns.tolist()]
        for _, row in df_tabla.iterrows():
            table_data.append(row.tolist())
        
        # Crear tabla
        zona_table = Table(table_data, colWidths=[0.6*inch, 0.6*inch, 1.2*inch, 0.5*inch, 1.0*inch, 0.5*inch, 0.6*inch])
        zona_table.setStyle(TableStyle([
            ('BACKGROUND', (0, 0), (-1, 0), colors.darkblue),
            ('TEXTCOLOR', (0, 0), (-1, 0), colors.white),
            ('ALIGN', (0, 0), (-1, -1), 'CENTER'),
            ('FONTNAME', (0, 0), (-1, 0), 'Helvetica-Bold'),
            ('FONTSIZE', (0, 0), (-1, -1), 7),
            ('BACKGROUND', (0, 1), (-1, -1), colors.white),
            ('GRID', (0, 0), (-1, -1), 1, colors.black),
            ('ROWBACKGROUNDS', (0, 1), (-1, -1), [colors.white, colors.lightgrey])
        ]))
        story.append(zona_table)
        
        if len(gdf_analizado) > 10:
            story.append(Spacer(1, 5))
            story.append(Paragraph(f"* Mostrando 10 de {len(gdf_analizado)} sub-lotes totales. Consulte el archivo CSV para todos los datos.", 
                                 ParagraphStyle('Small', parent=normal_style, fontSize=8)))
        
        story.append(Spacer(1, 20))
        
        # RECOMENDACIONES DE GANADER√çA REGENERATIVA
        story.append(PageBreak())
        story.append(Paragraph("RECOMENDACIONES DE GANADER√çA REGENERATIVA", heading_style))
        
        # Determinar enfoque seg√∫n an√°lisis
        if biomasa_promedio < 1000:
            enfoque = "üö® **ENFOQUE: REGENERACI√ìN URGENTE** - Sistema degradado que requiere intervenci√≥n inmediata"
        elif biomasa_promedio < 2000:
            enfoque = "‚úÖ **ENFOQUE: MEJORA CONTINUA** - Sistema con potencial de mejora mediante pr√°cticas regenerativas"
        else:
            enfoque = "üåü **ENFOQUE: OPTIMIZACI√ìN REGENERATIVA** - Sistema saludable, enfoque en mantenimiento y resiliencia"
        
        story.append(Paragraph(enfoque, normal_style))
        story.append(Spacer(1, 15))
        
        # Obtener recomendaciones espec√≠ficas
        recomendaciones = RECOMENDACIONES_REGENERATIVAS.get(tipo_pastura, RECOMENDACIONES_REGENERATIVAS['PERSONALIZADO'])
        
        # Pr√°cticas regenerativas
        story.append(Paragraph("üå± **PR√ÅCTICAS REGENERATIVAS PRINCIPALES**", subheading_style))
        for rec in recomendaciones['PR√ÅCTICAS_REGENERATIVAS']:
            story.append(Paragraph(f"‚Ä¢ {rec}", normal_style))
        
        story.append(Spacer(1, 10))
        
        # Manejo de suelo
        story.append(Paragraph("üü´ **MANEJO REGENERATIVO DEL SUELO**", subheading_style))
        for rec in recomendaciones['MANEJO_SUELO']:
            story.append(Paragraph(f"‚Ä¢ {rec}", normal_style))
        
        story.append(Spacer(1, 10))
        
        # Biodiversidad
        story.append(Paragraph("üå≥ **BIODIVERSIDAD Y CONECTIVIDAD ECOL√ìGICA**", subheading_style))
        for rec in recomendaciones['BIODIVERSIDAD']:
            story.append(Paragraph(f"‚Ä¢ {rec}", normal_style))
        
        story.append(Spacer(1, 10))
        
        # Agua y retenci√≥n
        story.append(Paragraph("üíß **MANEJO REGENERATIVO DEL AGUA**", subheading_style))
        for rec in recomendaciones['AGUA_RETENCI√ìN']:
            story.append(Paragraph(f"‚Ä¢ {rec}", normal_style))
        
        story.append(Spacer(1, 20))
        
        # PLAN DE IMPLEMENTACI√ìN REGENERATIVA
        story.append(Paragraph("üìÖ PLAN DE IMPLEMENTACI√ìN REGENERATIVA", heading_style))
        
        planes = [
            ("INMEDIATO (0-30 d√≠as)", [
                "Diagn√≥stico participativo con equipo t√©cnico",
                "Dise√±o inicial del sistema rotacional",
                "Preparaci√≥n de insumos org√°nicos locales",
                "Identificaci√≥n de √°reas prioritarias de intervenci√≥n"
            ]),
            ("CORTO PLAZO (1-3 meses)", [
                "Implementaci√≥n de primera rotaci√≥n de pastoreo",
                "Establecimiento de coberturas vivas",
                "Aplicaci√≥n de biofertilizantes",
                "Instalaci√≥n de infraestructura b√°sica (cercas, aguadas)"
            ]),
            ("MEDIANO PLAZO (3-12 meses)", [
                "Ajuste del sistema seg√∫n monitoreo",
                "Diversificaci√≥n con √°rboles y arbustos",
                "Implementaci√≥n de cosecha de agua",
                "Capacitaci√≥n del personal en pr√°cticas regenerativas"
            ]),
            ("LARGO PLAZO (1-3 a√±os)", [
                "Consolidaci√≥n del sistema regenerativo",
                "Mejora gen√©tica del hato adaptada al sistema",
                "Comercializaci√≥n diferenciada por valor agregado",
                "R√©plica del modelo en otras √°reas"
            ])
        ]
        
        for periodo, acciones in planes:
            story.append(Paragraph(f"<b>{periodo}:</b>", subheading_style))
            for accion in acciones:
                story.append(Paragraph(f"‚Ä¢ {accion}", normal_style))
            story.append(Spacer(1, 5))
        
        story.append(Spacer(1, 20))
        
        # INDICADORES DE √âXITO REGENERATIVO
        story.append(Paragraph("üìä INDICADORES DE √âXITO REGENERATIVO", heading_style))
        
        indicadores_data = [
            ["Indicador", "Meta 6 meses", "Meta 12 meses", "Meta 24 meses"],
            ["Cobertura vegetal (%)", "> 60%", "> 75%", "> 85%"],
            ["Materia org√°nica suelo", "+ 0.5%", "+ 1.0%", "+ 1.5%"],
            ["Infiltraci√≥n agua (cm/h)", "+ 50%", "+ 100%", "+ 150%"],
            ["Diversidad especies", "+ 30%", "+ 60%", "+ 100%"],
            ["Costo alimentaci√≥n/animal", "- 20%", "- 35%", "- 50%"],
            ["Ganancia peso diaria", "+ 15%", "+ 25%", "+ 35%"]
        ]
        
        indicadores_table = Table(indicadores_data, colWidths=[1.5*inch, 1.2*inch, 1.2*inch, 1.2*inch])
        indicadores_table.setStyle(TableStyle([
            ('BACKGROUND', (0, 0), (-1, 0), colors.darkgreen),
            ('TEXTCOLOR', (0, 0), (-1, 0), colors.white),
            ('ALIGN', (0, 0), (-1, -1), 'CENTER'),
            ('FONTNAME', (0, 0), (-1, 0), 'Helvetica-Bold'),
            ('FONTSIZE', (0, 0), (-1, -1), 8),
            ('BACKGROUND', (0, 1), (-1, -1), colors.white),
            ('GRID', (0, 0), (-1, -1), 1, colors.black)
        ]))
        story.append(indicadores_table)
        
        story.append(Spacer(1, 20))
        
        # BENEFICIOS ESPERADOS
        story.append(Paragraph("üéØ BENEFICIOS ESPERADOS DEL SISTEMA REGENERATIVO", heading_style))
        
        beneficios = [
            ("üåø Ambientales", [
                "Aumento de la biodiversidad local",
                "Mejora de la calidad del suelo y agua",
                "Secuestro de carbono en suelo y biomasa",
                "Reducci√≥n de la erosi√≥n y desertificaci√≥n"
            ]),
            ("üí∞ Econ√≥micos", [
                "Reducci√≥n de costos en insumos externos",
                "Aumento de la productividad por hect√°rea",
                "Mejor valor comercial por calidad diferenciada",
                "Reducci√≥n de riesgos clim√°ticos y de mercado"
            ]),
            ("üë• Sociales", [
                "Creaci√≥n de empleo local calificado",
                "Mejora de la calidad de vida rural",
                "Fortalecimiento del conocimiento tradicional",
                "Desarrollo de capacidades locales"
            ])
        ]
        
        for categoria, items in beneficios:
            story.append(Paragraph(f"<b>{categoria}:</b>", subheading_style))
            for item in items:
                story.append(Paragraph(f"‚Ä¢ {item}", normal_style))
            story.append(Spacer(1, 5))
        
        # Pie de p√°gina
        story.append(PageBreak())
        story.append(Paragraph("INFORMACI√ìN ADICIONAL", heading_style))
        story.append(Paragraph("Este informe fue generado autom√°ticamente por el Sistema de An√°lisis Forrajero con Ganader√≠a Regenerativa.", normal_style))
        story.append(Paragraph("La ganader√≠a regenerativa busca replicar los patrones de la naturaleza para crear sistemas productivos resilientes, diversos y econ√≥micamente viables.", normal_style))
        story.append(Spacer(1, 10))
        story.append(Paragraph("<b>Principios de la Ganader√≠a Regenerativa:</b>", normal_style))
        story.append(Paragraph("1. Contexto - Entender el ecosistema local completo", normal_style))
        story.append(Paragraph("2. Planificaci√≥n Hol√≠stica - Integrar objetivos econ√≥micos, sociales y ambientales", normal_style))
        story.append(Paragraph("3. Pastoreo Planificado - Imitar los patrones de los herb√≠voros silvestres", normal_style))
        story.append(Paragraph("4. Cobertura del Suelo - Mantener el suelo siempre protegido", normal_style))
        story.append(Paragraph("5. Biodiversidad - Fomentar la diversidad de plantas y animales", normal_style))
        story.append(Paragraph("6. Ciclos de Nutrientes - Cerrar los ciclos de nutrientes localmente", normal_style))
        
        story.append(Spacer(1, 15))
        story.append(Paragraph("Para consultas t√©cnicas o implementaci√≥n de sistemas regenerativos, contacte con especialistas en ganader√≠a regenerativa certificados.", normal_style))
        
        # Generar PDF
        doc.build(story)
        buffer.seek(0)
        
        return buffer
        
    except Exception as e:
        st.error(f"Error generando PDF: {str(e)}")
        import traceback
        st.error(f"Detalle: {traceback.format_exc()}")
        return None

# A√ëADIR ESTA PARTE EN LA SECCI√ìN DE EXPORTACI√ìN (despu√©s del GeoJSON y CSV)

def mostrar_seccion_exportacion_pdf():
    """Muestra la secci√≥n de exportaci√≥n de PDF en la interfaz"""
    
    if st.session_state.gdf_analizado is not None:
        st.markdown("---")
        st.subheader("üìÑ GENERAR INFORME PDF COMPLETO")
        
        col1, col2 = st.columns([2, 1])
        
        with col1:
            st.info("""
            **El informe PDF incluir√°:**
            ‚Ä¢ Resumen ejecutivo del an√°lisis
            ‚Ä¢ Estad√≠sticas detalladas por sub-lote
            ‚Ä¢ Mapas de distribuci√≥n de vegetaci√≥n
            ‚Ä¢ Recomendaciones espec√≠ficas de ganader√≠a regenerativa
            ‚Ä¢ Plan de implementaci√≥n por fases
            ‚Ä¢ Indicadores de √©xito y beneficios esperados
            """)
        
        with col2:
            if st.button("üñ®Ô∏è Generar Informe PDF", type="primary", use_container_width=True):
                with st.spinner("Generando informe PDF con recomendaciones regenerativas..."):
                    pdf_buffer = generar_informe_pdf(
                        st.session_state.gdf_analizado,
                        tipo_pastura,
                        peso_promedio,
                        carga_animal,
                        st.session_state.area_total,
                        fecha_imagen,
                        fuente_satelital
                    )
                    
                    if pdf_buffer:
                        st.download_button(
                            "üì• Descargar Informe PDF Completo",
                            pdf_buffer.getvalue(),
                            f"informe_regenerativo_{tipo_pastura}_{datetime.now().strftime('%Y%m%d_%H%M')}.pdf",
                            "application/pdf",
                            key="descarga_pdf"
                        )
                        st.success("‚úÖ Informe PDF generado exitosamente!")
                    else:
                        st.error("‚ùå Error al generar el PDF")

# FINALMENTE, LLAMAR A LA FUNCI√ìN EN LA INTERFAZ PRINCIPAL
# Buscar en el c√≥digo donde est√° la secci√≥n de exportaci√≥n y a√±adir:

# En la funci√≥n principal, despu√©s de la exportaci√≥n de GeoJSON y CSV, a√±adir:
mostrar_seccion_exportacion_pdf()
